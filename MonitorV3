-- Script Logger usando Orion Library
-- Monitora e exibe scripts executados no servidor

local OrionLib = loadstring(game:HttpGet('https://raw.githubusercontent.com/VerbalHubz/Verbal-Hub/refs/heads/main/Orion%20Hub%20Ui%20V3'))()

-- Configura√ß√£o da janela principal
local Window = OrionLib:MakeWindow({
    Name = "Script Logger - Monitor de Atividades",
    HidePremium = false,
    SaveConfig = true,
    ConfigFolder = "ScriptLogger"
})

-- Vari√°veis globais
local scriptLogs = {}
local maxLogs = 100
local isLogging = true
local logCount = 0

-- Fun√ß√£o para formatar timestamp
local function getTimestamp()
    return os.date("[%H:%M:%S]")
end

-- Fun√ß√£o para adicionar log
local function addLog(playerName, scriptInfo, scriptType)
    if not isLogging then return end
    
    logCount = logCount + 1
    local logEntry = {
        id = logCount,
        timestamp = getTimestamp(),
        player = playerName or "Desconhecido",
        script = scriptInfo or "Script Desconhecido",
        type = scriptType or "Executado",
        time = tick()
    }
    
    table.insert(scriptLogs, 1, logEntry)
    
    -- Limita o n√∫mero de logs
    if #scriptLogs > maxLogs then
        table.remove(scriptLogs, #scriptLogs)
    end
    
    -- Atualiza a interface se existir
    if logListBox then
        updateLogDisplay()
    end
end

-- Fun√ß√£o para detectar scripts
local function detectScripts()
    -- Monitor de novos scripts criados
    local function onChildAdded(child)
        if child:IsA("LocalScript") or child:IsA("Script") then
            local player = game.Players:GetPlayerFromCharacter(child.Parent) or 
                          game.Players:FindFirstChild(child.Parent.Name)
            local playerName = player and player.Name or "Sistema"
            
            addLog(playerName, child.Name, "Script Criado")
        end
    end
    
    -- Monitora workspace
    workspace.ChildAdded:Connect(onChildAdded)
    workspace.DescendantAdded:Connect(function(descendant)
        if descendant:IsA("LocalScript") or descendant:IsA("Script") then
            local player = game.Players:GetPlayerFromCharacter(descendant.Parent) or 
                          game.Players:FindFirstChild(descendant.Parent.Name)
            local playerName = player and player.Name or "Sistema"
            
            addLog(playerName, descendant.Name, "Script Detectado")
        end
    end)
    
    -- Monitora players
    for _, player in pairs(game.Players:GetPlayers()) do
        if player.Character then
            player.Character.ChildAdded:Connect(onChildAdded)
            player.Character.DescendantAdded:Connect(function(descendant)
                if descendant:IsA("LocalScript") or descendant:IsA("Script") then
                    addLog(player.Name, descendant.Name, "Script no Character")
                end
            end)
        end
        
        player.CharacterAdded:Connect(function(character)
            character.ChildAdded:Connect(onChildAdded)
            character.DescendantAdded:Connect(function(descendant)
                if descendant:IsA("LocalScript") or descendant:IsA("Script") then
                    addLog(player.Name, descendant.Name, "Script no Character")
                end
            end)
        end)
    end
    
    -- Monitora novos players
    game.Players.PlayerAdded:Connect(function(player)
        player.CharacterAdded:Connect(function(character)
            character.ChildAdded:Connect(onChildAdded)
            character.DescendantAdded:Connect(function(descendant)
                if descendant:IsA("LocalScript") or descendant:IsA("Script") then
                    addLog(player.Name, descendant.Name, "Script no Character")
                end
            end)
        end)
    end)
end

-- Tab principal - Logs
local LogTab = Window:MakeTab({
    Name = "üìã Logs de Scripts",
    Icon = "rbxassetid://4483345998",
    PremiumOnly = false
})

-- Vari√°vel global para o log display
logListBox = nil

-- Fun√ß√£o para atualizar display dos logs
function updateLogDisplay()
    if not logListBox then return end
    
    local displayText = ""
    for i, log in ipairs(scriptLogs) do
        if i > 20 then break end -- Mostra apenas os 20 mais recentes
        displayText = displayText .. string.format(
            "%s [%s] %s executou: %s (%s)\n",
            log.timestamp,
            log.type,
            log.player,
            log.script,
            log.id
        )
    end
    
    if displayText == "" then
        displayText = "Nenhum script detectado ainda..."
    end
    
    -- Atualiza o texto (isso pode variar dependendo da vers√£o da Orion)
    -- Como a Orion n√£o tem update direto para labels, recriaremos se necess√°rio
end

-- Se√ß√£o de status
LogTab:AddSection({
    Name = "Status do Logger"
})

local statusLabel = LogTab:AddLabel("Status: Ativo - Logs: 0")

-- Toggle para ativar/desativar logging
LogTab:AddToggle({
    Name = "Ativar Logger",
    Default = true,
    Callback = function(Value)
        isLogging = Value
        statusLabel:Set(string.format("Status: %s - Logs: %d", 
            isLogging and "Ativo" or "Inativo", #scriptLogs))
    end    
})

-- Se√ß√£o de logs
LogTab:AddSection({
    Name = "Logs Recentes"
})

-- Display dos logs
local logDisplay = LogTab:AddLabel("Aguardando detec√ß√£o de scripts...")

-- Fun√ß√£o para atualizar o display periodicamente
spawn(function()
    while true do
        wait(1)
        if isLogging then
            local displayText = ""
            for i = 1, math.min(10, #scriptLogs) do
                local log = scriptLogs[i]
                displayText = displayText .. string.format(
                    "%s %s: %s\n",
                    log.timestamp,
                    log.player,
                    log.script
                )
            end
            
            if displayText == "" then
                displayText = "Nenhum script detectado..."
            end
            
            logDisplay:Set(displayText)
            statusLabel:Set(string.format("Status: %s - Logs: %d", 
                isLogging and "Ativo" or "Inativo", #scriptLogs))
        end
    end
end)

-- Bot√£o para limpar logs
LogTab:AddButton({
    Name = "Limpar Logs",
    Callback = function()
        scriptLogs = {}
        logCount = 0
        logDisplay:Set("Logs limpos!")
        statusLabel:Set(string.format("Status: %s - Logs: 0", 
            isLogging and "Ativo" or "Inativo"))
    end    
})

-- Tab de configura√ß√µes
local ConfigTab = Window:MakeTab({
    Name = "‚öôÔ∏è Configura√ß√µes",
    Icon = "rbxassetid://4483345998",
    PremiumOnly = false
})

ConfigTab:AddSection({
    Name = "Configura√ß√µes do Logger"
})

-- Slider para m√°ximo de logs
ConfigTab:AddSlider({
    Name = "M√°ximo de Logs",
    Min = 10,
    Max = 500,
    Default = 100,
    Color = Color3.fromRGB(255,255,255),
    Increment = 10,
    ValueName = "logs",
    Callback = function(Value)
        maxLogs = Value
        -- Remove logs extras se necess√°rio
        while #scriptLogs > maxLogs do
            table.remove(scriptLogs, #scriptLogs)
        end
    end    
})

-- Toggle para diferentes tipos de detec√ß√£o
ConfigTab:AddToggle({
    Name = "Detectar Scripts do Sistema",
    Default = true,
    Callback = function(Value)
        detectSystemScripts = Value
    end    
})

ConfigTab:AddToggle({
    Name = "Detectar LocalScripts",
    Default = true,
    Callback = function(Value)
        detectLocalScripts = Value
    end    
})

-- Tab de informa√ß√µes
local InfoTab = Window:MakeTab({
    Name = "‚ÑπÔ∏è Informa√ß√µes",
    Icon = "rbxassetid://4483345998",
    PremiumOnly = false
})

InfoTab:AddSection({
    Name = "Como Usar"
})

InfoTab:AddLabel("1. Ative o Logger na aba Logs")
InfoTab:AddLabel("2. O script detectar√° automaticamente")
InfoTab:AddLabel("   novos scripts executados")
InfoTab:AddLabel("3. Visualize os logs na aba principal")
InfoTab:AddLabel("4. Configure nas Configura√ß√µes")

InfoTab:AddSection({
    Name = "Recursos"
})

InfoTab:AddLabel("‚Ä¢ Detec√ß√£o autom√°tica de scripts")
InfoTab:AddLabel("‚Ä¢ Identifica√ß√£o do jogador")
InfoTab:AddLabel("‚Ä¢ Timestamp dos eventos")
InfoTab:AddLabel("‚Ä¢ Hist√≥rico configur√°vel")
InfoTab:AddLabel("‚Ä¢ Interface limpa e organizada")

-- Bot√£o de exportar logs (salva no clipboard se poss√≠vel)
InfoTab:AddButton({
    Name = "Exportar Logs",
    Callback = function()
        local exportText = "=== SCRIPT LOGGER EXPORT ===\n"
        exportText = exportText .. string.format("Data: %s\n", os.date())
        exportText = exportText .. string.format("Total de Logs: %d\n\n", #scriptLogs)
        
        for _, log in ipairs(scriptLogs) do
            exportText = exportText .. string.format(
                "%s [%s] %s executou: %s\n",
                log.timestamp,
                log.type,
                log.player,
                log.script
            )
        end
        
        -- Tenta copiar para clipboard (nem sempre funciona no Roblox)
        if setclipboard then
            setclipboard(exportText)
            OrionLib:MakeNotification({
                Name = "Exporta√ß√£o",
                Content = "Logs copiados para clipboard!",
                Image = "rbxassetid://4483345998",
                Time = 3
            })
        else
            print(exportText)
            OrionLib:MakeNotification({
                Name = "Exporta√ß√£o",
                Content = "Logs exportados no console!",
                Image = "rbxassetid://4483345998",
                Time = 3
            })
        end
    end    
})

-- Inicializa o sistema de detec√ß√£o
detectScripts()

-- Notification de inicializa√ß√£o
OrionLib:MakeNotification({
    Name = "Script Logger",
    Content = "Logger ativado! Monitorando scripts...",
    Image = "rbxassetid://4483345998",
    Time = 5
})

-- Inicializa a Orion
OrionLib:Init()
